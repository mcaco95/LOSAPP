{% extends "base.html" %}

{% block head %}
<!-- Add jQuery first -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- We'll load Twilio dynamically -->
{% endblock %}

{% block extra_js %}
<!-- Operations specific JavaScript -->
<script>
    // Pass user ID to JavaScript
    const currentUserId = {{ current_user.id }};
</script>
<script src="{{ url_for('static', filename='js/operations.js') }}"></script>
{% endblock %}

{% block content %}
<div class="container-fluid px-2">
    <div class="row g-3">
        <!-- User Info Card -->
        <div class="col-12 col-xl-3">
            <div class="card border-0 shadow h-100">
                <div class="card-header">
                    <h2 class="fs-5 fw-bold mb-0">Operations Dashboard</h2>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <h3 class="h5 mb-3">Welcome, {{ user.name }}</h3>
                        <p class="mb-0">
                            <span class="fw-bold">Role:</span> {{ role | title }}
                            <br>
                            <span class="fw-bold">Extension:</span> {{ extension or 'Not set' }}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alert KPIs Dashboard -->
        <div class="col-12 col-xl-9">
            <div class="row g-3 mb-4">
                <!-- Today's Alerts -->
                <div class="col-12 col-sm-6 col-xl-3">
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="icon-shape icon-shape-primary rounded me-3">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div>
                                    <h2 class="h6 text-gray-400 mb-0">Today's Alerts</h2>
                                    <h3 class="fw-extrabold mb-0" id="todayAlerts">0</h3>
                                    <small class="text-muted" id="todayAlertsChange">+0 from yesterday</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Unassigned Alerts -->
                <div class="col-12 col-sm-6 col-xl-3">
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="icon-shape icon-shape-warning rounded me-3">
                                    <i class="fas fa-user-slash"></i>
                                </div>
                                <div>
                                    <h2 class="h6 text-gray-400 mb-0">Unassigned</h2>
                                    <h3 class="fw-extrabold mb-0" id="unassignedAlerts">0</h3>
                                    <small class="text-muted" id="unassignedPercentage">0% of total</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- In Progress Alerts -->
                <div class="col-12 col-sm-6 col-xl-3">
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="icon-shape icon-shape-info rounded me-3">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div>
                                    <h2 class="h6 text-gray-400 mb-0">In Progress</h2>
                                    <h3 class="fw-extrabold mb-0" id="inProgressAlerts">0</h3>
                                    <small class="text-muted" id="avgResolutionTime">Avg: 0h 0m</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resolved Today -->
                <div class="col-12 col-sm-6 col-xl-3">
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="icon-shape icon-shape-success rounded me-3">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div>
                                    <h2 class="h6 text-gray-400 mb-0">Resolved Today</h2>
                                    <h3 class="fw-extrabold mb-0" id="resolvedToday">0</h3>
                                    <small class="text-muted" id="resolutionRate">0% resolution rate</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional KPI Row -->
            <div class="row g-3">
                <!-- Critical Alerts -->
                <div class="col-12 col-sm-6 col-xl-3">
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="icon-shape icon-shape-danger rounded me-3">
                                    <i class="fas fa-fire"></i>
                                </div>
                                <div>
                                    <h2 class="h6 text-gray-400 mb-0">Critical Alerts</h2>
                                    <h3 class="fw-extrabold mb-0" id="criticalAlerts">0</h3>
                                    <small class="text-muted" id="criticalPercentage">0% of total</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Escalated Alerts -->
                <div class="col-12 col-sm-6 col-xl-3">
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="icon-shape icon-shape-secondary rounded me-3">
                                    <i class="fas fa-arrow-up"></i>
                                </div>
                                <div>
                                    <h2 class="h6 text-gray-400 mb-0">Escalated</h2>
                                    <h3 class="fw-extrabold mb-0" id="escalatedAlerts">0</h3>
                                    <small class="text-muted" id="escalatedAge">Avg age: 0h</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Response Time -->
                <div class="col-12 col-sm-6 col-xl-3">
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="icon-shape icon-shape-tertiary rounded me-3">
                                    <i class="fas fa-stopwatch"></i>
                                </div>
                                <div>
                                    <h2 class="h6 text-gray-400 mb-0">Avg Response</h2>
                                    <h3 class="fw-extrabold mb-0" id="avgResponseTime">0m</h3>
                                    <small class="text-muted" id="responseTarget">Target: 15m</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Team Performance -->
                <div class="col-12 col-sm-6 col-xl-3">
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="icon-shape icon-shape-primary rounded me-3">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div>
                                    <h2 class="h6 text-gray-400 mb-0">Active Agents</h2>
                                    <h3 class="fw-extrabold mb-0" id="activeAgents">0</h3>
                                    <small class="text-muted" id="teamEfficiency">0 alerts/agent</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Samsara Alerts Section -->
        <div class="col-12">
            <div class="card border-0 shadow">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Samsara Alerts</h5>
                        <div class="d-flex align-items-center">
                            <div class="col-md-6 col-lg-3 mb-3">
                                <label for="alertsPerPage" class="form-label">Per Page</label>
                                <select class="form-select" id="alertsPerPage">
                                    <option value="10">10</option>
                                    <option value="20" selected>20</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                            <button id="refreshAlerts" class="btn btn-sm btn-primary">
                                <i class="fas fa-sync-alt me-1"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <!-- Alert Filters -->
                    <div class="row g-2">
                        <div class="col-md-2">
                            <select id="statusFilter" class="form-select form-select-sm">
                                <option value="">All Statuses</option>
                                <option value="unassigned">Unassigned</option>
                                <option value="in_progress">In Progress</option>
                                <option value="resolved">Resolved</option>
                                <option value="escalated">Escalated</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select id="assignmentFilter" class="form-select form-select-sm">
                                <option value="">All Assignments</option>
                                <option value="unassigned">Unassigned</option>
                                <option value="my_alerts">My Alerts</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select id="clientFilter" class="form-select form-select-sm">
                                <option value="">All Clients</option>
                                <!-- Clients will be loaded here -->
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="date" id="dateFilter" class="form-control form-control-sm" placeholder="Filter by date">
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="searchFilter" class="form-control form-control-sm" placeholder="Search alerts...">
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <!-- Pagination moved to top -->
                    <div id="alertsPagination" class="mt-2 mb-3 px-3">
                        <!-- Pagination will be rendered here -->
                    </div>
                    
                    <!-- Top horizontal scrollbar -->
                    <div class="top-scrollbar-wrapper">
                        <div class="top-scrollbar-content"></div>
                    </div>
                    
                    <!-- Alerts Table -->
                    <div class="table-responsive" id="tableContainer">
                        <table class="table table-striped table-hover table-compact" id="alertsTable">
                            <thead class="table-dark sticky-top">
                                <tr>
                                    <th scope="col" style="width: 50px;">Actions</th>
                                    <th scope="col" class="sortable-header" data-sort="timestamp" style="cursor: pointer; width: 140px;">
                                        Alert Time <i class="fas fa-sort-down sort-icon"></i>
                                    </th>
                                    <th scope="col" class="sortable-header" data-sort="created_at" style="cursor: pointer; width: 140px;">
                                        Created Time <i class="fas fa-sort sort-icon"></i>
                                    </th>
                                    <th scope="col" class="sortable-header" data-sort="updated_at" style="cursor: pointer; width: 140px;">
                                        Last Edited <i class="fas fa-sort sort-icon"></i>
                                    </th>
                                    <th scope="col" class="sortable-header" data-sort="vehicle_name" style="cursor: pointer; width: 80px;">
                                        Vehicle <i class="fas fa-sort sort-icon"></i>
                                    </th>
                                    <th scope="col" style="width: 100px;">Driver</th>
                                    <th scope="col" class="sortable-header" data-sort="alert_type" style="cursor: pointer; width: 120px;">
                                        Alert Type <i class="fas fa-sort sort-icon"></i>
                                    </th>
                                    <th scope="col" class="sortable-header" data-sort="severity" style="cursor: pointer; width: 120px;">
                                        Severity <i class="fas fa-sort sort-icon"></i>
                                    </th>
                                    <th scope="col" class="sortable-header" data-sort="status" style="cursor: pointer; width: 120px;">
                                        Status <i class="fas fa-sort sort-icon"></i>
                                    </th>
                                    <th scope="col" style="width: 120px;">Assigned To</th>
                                    <th scope="col" class="sortable-header" data-sort="client_name" style="cursor: pointer; width: 100px;">
                                        Client <i class="fas fa-sort sort-icon"></i>
                                    </th>
                                    <th scope="col" style="width: 150px;">Latest Note</th>
                                    <th scope="col" style="width: 100px;">Last Edited By</th>
                                </tr>
                            </thead>
                            <tbody id="alertsTableBody">
                                <!-- Alerts will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Alert Details Modal -->
<div class="modal fade" id="alertDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Alert Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Left Column - Alert Information -->
                    <div class="col-md-6">
                        <div class="row mb-3">
                            <div class="col-12">
                                <h6>Basic Information</h6>
                                <p class="mb-1"><strong>Alert ID:</strong> <span id="modalAlertId"></span></p>
                                <p class="mb-1"><strong>Type:</strong> <span id="modalAlertType"></span></p>
                                <p class="mb-1"><strong>Severity:</strong> <span id="modalSeverity"></span></p>
                                <p class="mb-1"><strong>Status:</strong> <span id="modalStatus"></span></p>
                                <p class="mb-1"><strong>Created:</strong> <span id="modalTimestamp"></span></p>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-12">
                                <h6>Vehicle Information</h6>
                                <p class="mb-1"><strong>Vehicle:</strong> <span id="modalVehicle"></span></p>
                                <p class="mb-1">
                                    <strong>Driver:</strong> 
                                    <span id="modalDriver"></span>
                                    <button id="callDriverBtn" class="btn btn-sm btn-success ms-2" style="display: none;" onclick="initiateDriverCall()">
                                        <i class="fas fa-phone me-1"></i> Call Driver
                                    </button>
                                </p>
                                <p class="mb-1"><strong>Location:</strong> <span id="modalLocation"></span></p>
                                <p class="mb-1"><strong>Client:</strong> <span id="modalClient"></span></p>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <h6>Update Assignment</h6>
                            <div class="row g-2 mb-2">
                                <div class="col-md-6">
                                    <label class="form-label small">Driver</label>
                                    <select id="updateDriver" class="form-select form-select-sm">
                                        <option value="">Select Driver</option>
                                        <!-- Drivers will be loaded here -->
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small">Vehicle</label>
                                    <select id="updateVehicle" class="form-select form-select-sm">
                                        <option value="">Select Vehicle</option>
                                        <!-- Vehicles will be loaded here -->
                                    </select>
                                </div>
                            </div>
                            <button id="updateAssignment" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-exchange-alt me-1"></i> Update Assignment
                            </button>
                        </div>
                        
                        <div class="mb-3">
                            <h6>Description</h6>
                            <p id="modalDescription"></p>
                        </div>
                        
                        <div class="mb-3">
                            <h6>Assignment</h6>
                            <div class="row g-2">
                                <div class="col-md-8">
                                    <select id="assignToUser" class="form-select">
                                        <option value="">Select User</option>
                                        <!-- Users will be loaded here -->
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <button id="assignAlert" class="btn btn-primary w-100">
                                        <i class="fas fa-user-plus me-1"></i> Assign
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <h6>Quick Actions</h6>
                            <div class="mb-2">
                                <select id="updateStatus" class="form-select">
                                    <option value="">Update Status</option>
                                    <option value="unassigned">Unassigned</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="resolved">Resolved</option>
                                    <option value="escalated">Escalated</option>
                                </select>
                            </div>
                            <button id="updateAlertStatus" class="btn btn-success">
                                <i class="fas fa-check me-1"></i> Update Status
                            </button>
                        </div>
                    </div>
                    
                    <!-- Right Column - Activity Timeline -->
                    <div class="col-md-6">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0">Activity Timeline</h6>
                            <button class="btn btn-sm btn-outline-primary" onclick="refreshActivities()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        
                        <!-- Add Note Form -->
                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="card-title">Add Note</h6>
                                <div class="mb-2">
                                    <textarea id="newNoteText" class="form-control" rows="3" placeholder="Add a note or comment..."></textarea>
                                </div>
                                <button id="addNoteBtn" class="btn btn-sm btn-primary">
                                    <i class="fas fa-plus me-1"></i> Add Note
                                </button>
                            </div>
                        </div>
                        
                        <!-- Activity Timeline -->
                        <div id="activityTimeline" class="timeline" style="max-height: 400px; overflow-y: auto;">
                            <!-- Activities will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Resolution Form Modal -->
<div class="modal fade" id="resolveAlertModal" tabindex="-1" role="dialog" aria-labelledby="resolveAlertModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="resolveAlertModalLabel">Resolve Alert</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="resolveAlertForm">
                    <input type="hidden" id="resolveAlertId">
                    <div class="mb-3">
                        <label for="resolutionNotes" class="form-label">Resolution Notes</label>
                        <textarea class="form-control" id="resolutionNotes" rows="3" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitResolution()">Submit Resolution</button>
            </div>
        </div>
    </div>
</div>

<style>
    .sortable-header {
        user-select: none;
        transition: background-color 0.2s;
    }
    
    .sortable-header:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }
    
    .sort-icon {
        font-size: 0.8em;
        margin-left: 5px;
        opacity: 0.7;
    }
    
    .note-column {
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .note-column em {
        color: #6c757d;
        font-style: italic;
    }
    
    .table-responsive {
        max-height: 70vh;
        overflow-y: auto;
        overflow-x: auto;
    }
    
    .sticky-top {
        position: sticky;
        top: 0;
        z-index: 10;
    }
    
    /* Row highlighting based on status/severity */
    .table-success {
        background-color: rgba(25, 135, 84, 0.1) !important;
    }
    
    .table-danger {
        background-color: rgba(220, 53, 69, 0.1) !important;
    }
    
    .table-warning {
        background-color: rgba(255, 193, 7, 0.1) !important;
    }
    
    /* Form controls in table */
    .form-select-sm {
        font-size: 0.875rem;
        padding: 0.25rem 0.5rem;
    }
    
    /* Enhanced dropdown styling */
    .severity-select, .status-select, .assignment-select {
        font-weight: 500;
        border-radius: 6px;
        border: 2px solid #dee2e6;
        transition: all 0.2s ease;
        min-width: 140px;
        font-size: 0.9rem;
        padding: 0.5rem 0.75rem;
    }
    
    .severity-select:hover, .status-select:hover, .assignment-select:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .severity-select:focus, .status-select:focus, .assignment-select:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        transform: none;
    }
    
    /* Severity color coding */
    .severity-low {
        background-color: #d1e7dd;
        border-color: #198754;
        color: #0f5132;
    }
    
    .severity-medium {
        background-color: #fff3cd;
        border-color: #ffc107;
        color: #664d03;
    }
    
    .severity-high {
        background-color: #f8d7da;
        border-color: #fd7e14;
        color: #842029;
    }
    
    .severity-critical {
        background-color: #f8d7da;
        border-color: #dc3545;
        color: #721c24;
        font-weight: 600;
    }
    
    /* Status color coding */
    .status-unassigned {
        background-color: #f8f9fa;
        border-color: #6c757d;
        color: #495057;
    }
    
    .status-assigned {
        background-color: #cff4fc;
        border-color: #0dcaf0;
        color: #055160;
    }
    
    .status-in_progress {
        background-color: #e2e3e5;
        border-color: #0d6efd;
        color: #041e42;
    }
    
    .status-resolved {
        background-color: #d1e7dd;
        border-color: #198754;
        color: #0f5132;
    }
    
    .status-escalated {
        background-color: #f8d7da;
        border-color: #dc3545;
        color: #721c24;
        font-weight: 600;
    }
    
    /* Assignment color coding */
    .assignment-select.assigned {
        background-color: #e7f3ff;
        border-color: #0d6efd;
        color: #0a58ca;
    }
    
    .assignment-select.unassigned {
        background-color: #f8f9fa;
        border-color: #6c757d;
        color: #495057;
    }
    
    /* Enhanced horizontal scroll bar styling */
    .table-responsive::-webkit-scrollbar {
        height: 12px;
    }
    
    .table-responsive::-webkit-scrollbar-track {
        background: #f8f9fa;
        border-radius: 6px;
        border: 1px solid #dee2e6;
    }
    
    .table-responsive::-webkit-scrollbar-thumb {
        background: linear-gradient(45deg, #007bff, #0056b3);
        border-radius: 6px;
        border: 1px solid #0056b3;
    }
    
    .table-responsive::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(45deg, #0056b3, #004085);
    }
    
    /* Vertical scrollbar styling */
    .table-responsive::-webkit-scrollbar:vertical {
        width: 8px;
    }
    
    /* Make table minimum width to ensure horizontal scroll */
    #alertsTable {
        min-width: 1400px;
        font-size: 0.85rem;
    }
    
    /* Compact table styling */
    .table-compact {
        --bs-table-cell-padding-y: 0.4rem;
        --bs-table-cell-padding-x: 0.5rem;
    }
    
    .table-compact th {
        padding: 0.4rem 0.5rem;
        font-size: 0.8rem;
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .table-compact td {
        padding: 0.4rem 0.5rem;
        vertical-align: middle;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    /* Compact button styling */
    .table-compact .btn-sm {
        padding: 0.2rem 0.4rem;
        font-size: 0.75rem;
    }
    
    /* Enhanced dropdown styling - more compact */
    .severity-select, .status-select, .assignment-select {
        font-weight: 500;
        border-radius: 4px;
        border: 1px solid #dee2e6;
        transition: all 0.2s ease;
        min-width: 110px;
        font-size: 0.8rem;
        padding: 0.3rem 0.5rem;
        height: auto;
    }
    
    .severity-select:hover, .status-select:hover, .assignment-select:hover {
        transform: translateY(-1px);
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .severity-select:focus, .status-select:focus, .assignment-select:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 0.15rem rgba(13, 110, 253, 0.25);
        transform: none;
    }
    
    /* Pagination styling */
    #alertsPagination {
        border-bottom: 1px solid #dee2e6;
        background-color: #f8f9fa;
        margin: 0 !important;
        padding: 1rem !important;
    }
    
    #alertsPagination .pagination {
        margin-bottom: 0;
    }
    
    /* Top horizontal scrollbar */
    .top-scrollbar-wrapper {
        overflow-x: auto;
        overflow-y: hidden;
        height: 20px;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-bottom: none;
        margin: 0 15px;
    }
    
    .top-scrollbar-content {
        height: 1px;
        /* Width will be set by JavaScript to match table width */
    }
    
    /* Enhanced scrollbar styling for top scrollbar */
    .top-scrollbar-wrapper::-webkit-scrollbar {
        height: 12px;
    }
    
    .top-scrollbar-wrapper::-webkit-scrollbar-track {
        background: #f8f9fa;
        border-radius: 6px;
    }
    
    .top-scrollbar-wrapper::-webkit-scrollbar-thumb {
        background: linear-gradient(45deg, #007bff, #0056b3);
        border-radius: 6px;
        border: 1px solid #0056b3;
    }
    
    .top-scrollbar-wrapper::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(45deg, #0056b3, #004085);
    }
    
    /* Compact card styling */
    .card-body {
        padding: 0.75rem;
    }
    
    .card-header {
        padding: 0.5rem 0.75rem;
    }
    
    /* Compact pagination */
    #alertsPagination {
        border-bottom: 1px solid #dee2e6;
        background-color: #f8f9fa;
        margin: 0 !important;
        padding: 0.5rem !important;
    }
    
    /* Compact table styling */
    .table-compact {
        --bs-table-cell-padding-y: 0.4rem;
        --bs-table-cell-padding-x: 0.5rem;
    }
</style>

<script>
    // Sync scrollbars after DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        const topScrollbar = document.querySelector('.top-scrollbar-wrapper');
        const tableContainer = document.getElementById('tableContainer');
        const topScrollbarContent = document.querySelector('.top-scrollbar-content');
        const table = document.getElementById('alertsTable');
        
        function syncScrollbars() {
            if (table && topScrollbarContent) {
                // Set the width of the top scrollbar content to match the table width
                topScrollbarContent.style.width = table.scrollWidth + 'px';
            }
        }
        
        // Sync top scrollbar with table scrolling
        if (tableContainer && topScrollbar) {
            tableContainer.addEventListener('scroll', function() {
                topScrollbar.scrollLeft = tableContainer.scrollLeft;
            });
            
            topScrollbar.addEventListener('scroll', function() {
                tableContainer.scrollLeft = topScrollbar.scrollLeft;
            });
        }
        
        // Initial sync and sync after table updates
        syncScrollbars();
        
        // Re-sync when window resizes
        window.addEventListener('resize', syncScrollbars);
        
        // Re-sync when alerts are loaded (override the original loadAlerts)
        const originalLoadAlerts = window.loadAlerts;
        window.loadAlerts = function(...args) {
            const result = originalLoadAlerts.apply(this, args);
            setTimeout(syncScrollbars, 100); // Small delay to ensure table is rendered
            return result;
        };
    });
</script>
{% endblock %} 