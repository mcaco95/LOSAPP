{% extends "base.html" %}

{% block head %}
<style>
    .driver-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        margin-right: 10px;
    }
    
    .alert-stats {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
    }
    
    .alert-stats .badge {
        font-size: 0.7rem;
    }
    
    .driver-status-active {
        color: #28a745;
    }
    
    .driver-status-inactive {
        color: #dc3545;
    }
    
    .table th {
        border-top: none;
        font-weight: 600;
        color: #495057;
        background-color: #f8f9fa;
    }
    
    .driver-row:hover {
        background-color: #f8f9fa;
        cursor: pointer;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 mb-0">Driver Management</h1>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary" onclick="refreshDrivers()">
                        <i class="fas fa-sync-alt me-2"></i>Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters and Search -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="searchDrivers" class="form-label">Search Drivers</label>
                            <input type="text" id="searchDrivers" class="form-control" placeholder="Search by name, username, phone, email...">
                        </div>
                        <div class="col-md-3">
                            <label for="companyFilter" class="form-label">Company</label>
                            <select class="form-select" id="companyFilter">
                                <option value="">All Companies</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="statusFilter" class="form-label">Status</label>
                            <select class="form-select" id="statusFilter">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="sortBy" class="form-label">Sort By</label>
                            <select class="form-select" id="sortBy">
                                <option value="name">Name</option>
                                <option value="company_name">Company</option>
                                <option value="created_at">Date Added</option>
                                <option value="updated_at">Last Updated</option>
                            </select>
                        </div>
                        <div class="col-md-1">
                            <label for="sortOrder" class="form-label">Order</label>
                            <select class="form-select" id="sortOrder">
                                <option value="asc">A-Z</option>
                                <option value="desc">Z-A</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Drivers Table -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Drivers</h5>
                        <div id="driversCount" class="text-muted">
                            <!-- Driver count will be shown here -->
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <!-- Pagination Top -->
                    <div id="driversPaginationTop" class="mt-2 mb-3 px-3">
                        <!-- Pagination will be rendered here -->
                    </div>
                    
                    <!-- Drivers Table -->
                    <div class="table-responsive">
                        <table class="table table-hover mb-0" id="driversTable">
                            <thead class="sticky-top">
                                <tr>
                                    <th style="width: 250px;">Driver</th>
                                    <th style="width: 120px;">Status</th>
                                    <th style="width: 150px;">Contact</th>
                                    <th style="width: 120px;">License</th>
                                    <th style="width: 180px;">Company</th>
                                    <th style="width: 120px;">Alerts</th>
                                    <th style="width: 120px;">Added</th>
                                    <th style="width: 100px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="driversTableBody">
                                <!-- Drivers will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Loading State -->
                    <div id="driversLoading" class="text-center py-4" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <div class="mt-2">Loading drivers...</div>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="driversEmpty" class="text-center py-5" style="display: none;">
                        <i class="fas fa-users fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No drivers found</h5>
                        <p class="text-muted">Try adjusting your search criteria or filters.</p>
                    </div>
                </div>
                
                <!-- Pagination Bottom -->
                <div class="card-footer">
                    <div id="driversPaginationBottom">
                        <!-- Pagination will be rendered here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Driver Details Modal -->
<div class="modal fade" id="driverDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Driver Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="driverDetailsContent">
                    <!-- Driver details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="viewDriverPage()">
                    <i class="fas fa-external-link-alt me-2"></i>View Full Page
                </button>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/drivers.js') }}"></script>
{% endblock %} 